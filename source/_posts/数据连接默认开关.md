---
title: 数据连接默认开关
date: 2017-09-22 11:18:36
tags:
---
对于单卡和双卡工程，统一通过lib调用TelephonyExt.isDefaultDataOn()确认是否默认打开或关闭， lib与运营商定制有关，如联通的默认的数据连接开关设置可参考：TelephonyExtOP02。
单卡项目:
适用版本GB,GB2,ICS,ICS2,JB
其数据连接都是由\alps\mediatek\config\工程名\ProjectConfig.mk下的MTK_DEFAULT_DATA_OFF = no这个值来控制的
有MTK_DEFAULT_DATA_OFF=yes即默认关闭,设置成false就是默认打开

双卡项目:
Android V2.3(GB,GB2):
1.check一下PhoneProxy.java文件，看其中是否有一个变量mGPRSOn可以通过这个变量来控制数据开关的行为。
该值默认是false的，也就是默认GPRS是Off的，如果把它设为true，就会变成：如果插一张卡就设置为那张卡，如果是两张卡默认为卡槽1中的卡

Android V4.0(ICS,ICS2):
需要两个地方进行修改：
1.check一下PhoneProxy.java文件，看其中是否有一个变量mGPRSOn可以通过这个变量来控制数据开关的行为。
该值默认是false的，也就是默认GPRS是Off的，如果把它设为true，就会变成：如果插一张卡就设置为那张卡，如果是两张卡默认为卡槽1中的卡
2.请将framework\base\core\java\android\provider\settings.java文件中MOBILE_DATA_DEFAULT这个变量的值修改成1，然后再编译测试此功能

Android V4.1(JB)
也需要两个步骤:
1.将mGPRSOn设置成true:
1）如果是当前无论是哪个项目都需要将数据连接打开的话，直接将PhoneProxy.java文件的下面这段代码去掉：
``` Java
try{
	mTelephonyExt = MediatekClassFactory.createInstance(ITelephonyExt.class);
} catch (Exception e){
	e.printStackTrace();
}
if (mTelephonyExt != null) {
    if (mTelephonyExt.isDefaultDataOn()){
    	mGPRSOn = true;
    }
	
    if (mTelephonyExt.isAutoSwitchDataToEnabledSim())
        mAutoSwitchDataToEnabledSim = true;
    } else {
        loge("PhoneProxy(): mTelephonyExt is null!!!");
    }
}
//然后将private boolean mGPRSOn = false;改成true即可
```
2）如果是针对不同的运营商项目有不同的定制需求的话，需要将mediatek\operator\OP**\frameworks\java\com\mediatek\op\telephony下TelephonyExtOP**.java中加上下面这个方法：
``` Java
public boolean isDefaultDataOn() {
	return true;
}
```